# Fact extraction

This scenario explores extraction of information from reports for integrating with some other data or process. Here, we pick reports from one day - 18 August 1989, and (for the time being) focus on one particular event - the assassination of Colonel Waldemar Franklin Quintero.

The approach is based on linked data. Various processes can operate on documents in the corpus and generate RDF triples. These processes may orchestrated for some directed purpose, or may be independent but share a vocabulary. Sets of triples may be merged in various combinations, manipulated, filtered, edited and enriched in varied and interesting ways. This sort of thing is easier to explain with a worked example...

Consider these sources of linked data:

1. [Metadata](https://github.com/dstl/muc3/wiki/Metadata) - as might be generated by some document processing pipeline that is applied to all reports received. For this scenario, we're interested in the [documents](http://dstl.github.io/muc3/metadata/documents.rdf), [publisher](http://dstl.github.io/muc3/metadata/publisher.rdf) and [description](http://dstl.github.io/muc3/metadata/description.rdf) RDF files that might reasonably be expected from a pipeline.

2. [Extracted Information](https://github.com/dstl/muc3/wiki/Extracted-Information) - as might be created text analysis agents, human or machine, and where multiple agents might collaborate to produce a result. The scenaro here concerns an assassination event - so the [assassinations](http://dstl.github.io/muc3/events/assassination.rdf) RDF is of primary interest, but [kidnappings](http://dstl.github.io/muc3/events/kidnap.rdf) and [bombings/explosions(http://dstl.github.io/muc3/events/explosion.rdf) can be added to the mix too. 

Load these into the same triple store makes it's possible to create a register for reports on a single day that give this basic information. For example this query...

```
PREFIX dc: <http://purl.org/dc/elements/1.1/>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix skos: <http://www.w3.org/2004/02/skos/core#>
prefix gn: <http://www.geonames.org/ontology#>
prefix schema: <http://schema.org/>
prefix foaf: <http://xmlns.com/foaf/0.1/>
prefix dbo: <http://dbpedia.org/ontology/>

select ?doc ?coverage ?title ?publisher ?name ?description ?event ?eventPage
where {

  ?doc dc:date "1989-08-18"^^xsd:date; dc:title ?title; dc:coverage ?coverage.
  OPTIONAL {
    ?snippet rdfs:member ?doc.
    ?snippet rdf:type schema:Action.
    ?snippet schema:name ?name.
  }
  OPTIONAL {
    ?doc dc:description ?description.
    ?doc dc:publisher ?publisher.
  }
  OPTIONAL {
    ?doc schema:mentions ?event.
    ?event foaf:isPrimaryTopicOf ?eventPage.
  }
}
```

...generates **[this result](http://dstl.github.io/muc3/demo/daily.html)**. (which is [this SPARQL XML results file](input/query.srx) transformed to HTML with [this XSL stylesheet](xsl/query-html.xsl)).

Note the "pushpin" in the last column of the HTML table. This represents a link to extracted facts for some specific event mentioned in the report. It's picked out by one of the optional clauses in the query above:

```
 OPTIONAL {
    ?doc schema:mentions ?event.
    ?event foaf:isPrimaryTopicOf ?eventPage.
  }
```

We're slightly ahead of ourselves in that we dont's have the relevant triples in our triplestore just yet.


```java
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;

import org.apache.jena.rdf.model.Model;
import org.apache.jena.rdf.model.ModelFactory;
import org.apache.jena.riot.Lang;
import org.apache.jena.riot.RDFDataMgr;
import org.apache.jena.util.FileManager;

public class MergeAccountInfo {

       public static void main(String[] args) throws IOException {

        Model m = ModelFactory.createDefaultModel();

        FileManager.get().readModel( m, "demo/input/describe2.rdf" );
              RDFDataMgr.read(m, new FileInputStream("demo/triples/account_ttl.txt"), Lang.TTL);
        
        System.out.println( String.format( "The model contains %d triples", m.size() ) );
        
        m.write(new FileWriter("merged.xml"));

       }
}
```
